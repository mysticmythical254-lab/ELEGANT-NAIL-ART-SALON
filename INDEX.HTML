<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Emily's Nail Art Salon</title>

<!-- Tailwind CDN for quick styling -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent:#e11d48; /* pink */
    --muted:#6b7280;
  }
  html { scroll-behavior: smooth; }
  body { font-family: "Poppins", sans-serif; background-color:#fafafa; margin:0; }
  .hero-bg{
    background-position:center;
    background-size:cover;
    background-repeat:no-repeat;
    min-height:40vh;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .glass { background: rgba(255,255,255,0.85); box-shadow:0 6px 24px rgba(0,0,0,0.08); border-radius:14px; }
  /* Fullscreen modal */
  #fsModal { position:fixed; inset:0; background: rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:60; }
  #fsModal .fs-img { max-width:1200px; max-height:90vh; width:100%; object-fit:contain; transition: transform .25s ease; }
  .zoomed { transform: scale(1.6); cursor: zoom-out; }
  .service-card img { object-fit:cover; width:100%; height:12rem; }
  @media (min-width:768px){
    .service-card img { height:16rem; }
  }
</style>
</head>
<body>

<!-- ===== Header / Hero ===== -->
<header id="hero" class="hero-bg" style="background-image: url('https://images.unsplash.com/photo-1595461505976-7f65d0c7b44b?auto=format&fit=crop&w=1600&q=80');">
  <div class="glass p-6 md:p-12 mx-4 md:mx-16 text-center">
    <h1 class="text-3xl md:text-5xl font-bold text-pink-600">Emily's Nail Art Salon</h1>
    <p class="mt-2 text-sm md:text-lg text-gray-700">Where beauty meets art ✨ — Serving Nairobi County (Kawangware, Uthiru, Kinoo, Kangemi, Kabete Polytechnic)</p>
    <div class="mt-4 flex gap-3 justify-center">
      <a id="callBtn" href="tel:0714854394" class="px-4 py-2 rounded-md bg-pink-600 text-white">Call 0714854394</a>
      <a id="waBtn" href="https://wa.me/254714854394" target="_blank" class="px-4 py-2 rounded-md bg-green-600 text-white">WhatsApp</a>
      <a href="#gallery" class="px-4 py-2 rounded-md bg-pink-100 text-pink-700">View Gallery</a>
    </div>
    <p class="mt-3 text-xs text-gray-500">Tip: Owner & Developer can change these images from their panels.</p>
  </div>
</header>

<!-- ===== Main Content ===== -->
<main class="max-w-7xl mx-auto px-4 md:px-8 -mt-12">

  <!-- Services -->
  <section id="services" class="mb-10">
    <h2 class="text-2xl font-bold text-pink-600 mb-4">Services & Prices</h2>
    <div id="servicesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- service cards are injected by JS -->
    </div>
  </section>

  <!-- Gallery -->
  <section id="gallery" class="mb-10">
    <h2 class="text-2xl font-bold text-pink-600 mb-4">Our Gallery — Hands & Legs</h2>

    <h3 class="text-xl font-semibold text-pink-500 mt-4 mb-3">Hand Designs</h3>
    <div id="handsGallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-6">
      <!-- hand cards filled by JS -->
    </div>

    <h3 class="text-xl font-semibold text-pink-500 mt-6 mb-3">Leg / Pedicure Designs</h3>
    <div id="legsGallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <!-- leg cards filled by JS -->
    </div>
  </section>

  <!-- Booking / Requests -->
  <section id="booking" class="mb-10">
    <h2 class="text-2xl font-bold text-pink-600 mb-4">Request / Book a Service</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="glass p-5">
        <label class="block text-sm text-gray-600 mb-1">Your Name</label>
        <input id="clientName" class="border rounded-md p-2 w-full mb-3" placeholder="Full name" />
        <label class="block text-sm text-gray-600 mb-1">Phone</label>
        <input id="clientPhone" class="border rounded-md p-2 w-full mb-3" placeholder="0712XXXXXX" />
        <label class="block text-sm text-gray-600 mb-1">Choose Service</label>
        <select id="serviceSelect" class="border rounded-md p-2 w-full mb-3"></select>
        <label class="block text-sm text-gray-600 mb-1">Preferred Date & Time</label>
        <input id="serviceDatetime" type="datetime-local" class="border rounded-md p-2 w-full mb-3" />
        <button id="requestBtn" class="bg-pink-600 text-white px-4 py-2 rounded-md">Send Request</button>
        <p id="requestMsg" class="mt-2 text-sm text-green-600 hidden">Request sent — owner will respond.</p>
      </div>

      <div class="glass p-5">
        <h3 class="font-bold mb-2">Your Updates</h3>
        <ul id="clientUpdates" class="list-disc pl-5 text-sm text-gray-700"></ul>
        <hr class="my-4"/>
        <h3 class="font-bold mb-2">Reviews</h3>
        <div id="reviewsList" class="space-y-2 max-h-56 overflow-auto"></div>
        <div class="mt-3">
          <div class="flex items-center gap-2 mb-2">
            <label class="text-sm">Your Rating:</label>
            <div id="starWrap" class="flex gap-1"></div>
          </div>
          <textarea id="reviewText" class="border p-2 rounded-md w-full mb-2" rows="2" placeholder="Write a review..."></textarea>
          <button id="sendReviewBtn" class="bg-green-600 text-white px-4 py-1 rounded-md">Submit Review</button>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- ===== ADMIN LINKS (small, out of the main nav) ===== -->
<footer class="fixed bottom-4 right-4 z-50">
  <div class="flex flex-col gap-2">
    <a href="#owner" id="ownerLink" class="bg-white px-3 py-2 rounded-md shadow text-sm">Owner Panel</a>
    <a href="#developer" id="devLink" class="bg-white px-3 py-2 rounded-md shadow text-sm">Developer Panel</a>
  </div>
</footer>

<!-- ===== Fullscreen Modal for viewing images ===== -->
<div id="fsModal" class="hidden">
  <div style="position:relative; width:95%; max-width:1200px;">
    <img id="fsImg" class="fs-img" src="" alt="">
    <div style="color:white; text-align:center; margin-top:8px;" id="fsCaption"></div>
    <button id="fsClose" style="position:absolute; top:8px; right:8px; background:transparent; color:white; border:none; font-size:28px; cursor:pointer;">✕</button>
    <button id="fsPrev" style="position:absolute; left:8px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.08); color:white; border:none; padding:10px; border-radius:8px;">◀</button>
    <button id="fsNext" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.08); color:white; border:none; padding:10px; border-radius:8px;">▶</button>
  </div>
</div>

<!-- ===== OWNER PAGE (hash route #owner) ===== -->
<section id="ownerSection" class="hidden min-h-screen p-6 bg-gray-50">
  <div class="max-w-4xl mx-auto">
    <a href="#" onclick="goHome()" class="inline-block mb-4 text-sm text-pink-600">← Back to site</a>
    <div class="glass p-6">
      <h2 class="text-2xl font-bold text-pink-600 mb-3">Owner Panel</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Authentication -->
        <div>
          <label class="text-sm text-gray-700">Email (optional)</label>
          <input id="ownerEmail" class="border p-2 rounded w-full mb-2" placeholder="owner@example.com"/>
          <label class="text-sm text-gray-700">Owner password</label>
          <input id="ownerPass" type="password" class="border p-2 rounded w-full mb-2" placeholder="Set / Enter owner password"/>
          <button id="ownerLoginBtn" class="bg-pink-600 text-white px-4 py-2 rounded">Login / Set Password</button>
        </div>

        <!-- Contact & background -->
        <div>
          <label class="text-sm text-gray-700">Owner contact number</label>
          <input id="ownerNumber" class="border p-2 rounded w-full mb-2" placeholder="e.g. 0714854394" />
          <button id="saveOwnerNum" class="bg-yellow-500 text-white px-4 py-2 rounded mb-3">Save Contact</button>

          <label class="text-sm text-gray-700">Change background image</label>
          <input id="bgUpload" type="file" accept="image/*" class="mb-2" />
          <button id="saveBg" class="bg-indigo-600 text-white px-4 py-2 rounded">Upload Background</button>
        </div>
      </div>

      <hr class="my-4"/>

      <!-- Services management -->
      <div>
        <h3 class="font-semibold mb-2">Manage Services (Owner)</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="svcName" class="border p-2 rounded" placeholder="Service name (e.g. Plain Gel)" />
          <input id="svcPrice" class="border p-2 rounded" placeholder="Price e.g. 300" />
          <input id="svcCat" class="border p-2 rounded" placeholder="Category: Manicure / Pedicure / Nail Art" />
          <input id="svcImage" type="file" accept="image/*" class="border p-2 rounded" />
        </div>
        <div class="mt-2 flex gap-2">
          <button id="addServiceBtn" class="bg-green-600 text-white px-4 py-2 rounded">Add Service</button>
          <button id="clearServicesBtn" class="bg-gray-300 px-4 py-2 rounded">Clear Local Services</button>
        </div>
      </div>

      <hr class="my-4"/>

      <!-- Gallery management -->
      <div>
        <h3 class="font-semibold mb-2">Gallery Management (Owner)</h3>
        <label class="block text-sm text-gray-700 mb-1">Upload new Hand image</label>
        <input id="uploadHand" type="file" accept="image/*" class="mb-2" />
        <label class="block text-sm text-gray-700 mb-1">Upload new Leg image</label>
        <input id="uploadLeg" type="file" accept="image/*" class="mb-2" />
        <div class="flex gap-2 mt-2">
          <button id="addHandBtn" class="bg-pink-600 text-white px-4 py-2 rounded">Add Hand Image</button>
          <button id="addLegBtn" class="bg-pink-600 text-white px-4 py-2 rounded">Add Leg Image</button>
        </div>
      </div>

      <hr class="my-4"/>

      <!-- Requests -->
      <div>
        <h3 class="font-semibold mb-2">Service Requests</h3>
        <div id="ownerRequests" class="space-y-2"></div>
      </div>
    </div>
  </div>
</section>

<!-- ===== DEVELOPER PAGE (hash route #developer) ===== -->
<section id="devSection" class="hidden min-h-screen p-6 bg-gray-50">
  <div class="max-w-4xl mx-auto">
    <a href="#" onclick="goHome()" class="inline-block mb-4 text-sm text-pink-600">← Back to site</a>
    <div class="glass p-6">
      <h2 class="text-2xl font-bold text-pink-600 mb-3">Developer Panel</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="text-sm text-gray-700">Developer password</label>
          <input id="devPass" type="password" class="border p-2 rounded w-full mb-2" placeholder="Set / Enter developer password"/>
          <button id="devLoginBtn" class="bg-indigo-600 text-white px-4 py-2 rounded">Login / Set Password</button>
        </div>

        <div>
          <label class="text-sm text-gray-700">Maintenance Mode</label>
          <div class="flex gap-2 mt-2">
            <button id="enableMaint" class="bg-red-600 text-white px-4 py-2 rounded">Enable</button>
            <button id="disableMaint" class="bg-green-600 text-white px-4 py-2 rounded">Disable</button>
          </div>
          <p id="maintStatus" class="mt-2 text-sm text-gray-600">Status: OFF</p>
        </div>
      </div>

      <hr class="my-4"/>

      <div>
        <h3 class="font-semibold mb-2">Developer Gallery Controls</h3>
        <label class="block text-sm text-gray-700 mb-1">Upload background</label>
        <input id="devBgUpload" type="file" accept="image/*" class="mb-2" />
        <button id="devSaveBg" class="bg-indigo-600 text-white px-4 py-2 rounded">Upload bg</button>
      </div>

      <hr class="my-4"/>

      <div>
        <h3 class="font-semibold mb-2">Developer: Add Hand/Leg Images</h3>
        <input id="devHandFile" type="file" accept="image/*" class="mb-2" />
        <button id="devAddHand" class="bg-pink-600 text-white px-4 py-2 rounded mb-2">Add Hand</button>
        <input id="devLegFile" type="file" accept="image/*" class="mb-2" />
        <button id="devAddLeg" class="bg-pink-600 text-white px-4 py-2 rounded">Add Leg</button>
      </div>
    </div>
  </div>
</section>

<!-- ===== Scripts ===== -->
<script>
/* -------------- Data storage (localStorage) -------------- */
const STORAGE_KEYS = {
  BG: 'salon_bg',
  SERVICES: 'salon_services',
  HANDS: 'salon_hands',
  LEGS: 'salon_legs',
  REQUESTS: 'salon_requests',
  REVIEWS: 'salon_reviews',
  OWNER_PASS: 'salon_owner_pass',
  DEV_PASS: 'salon_dev_pass',
  OWNER_NUMBER: 'salon_owner_number'
};

function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function load(key, fallback){ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }

/* -------------- Sample default content (high-quality Unsplash) -------------- */
const defaultServices = [
  {id:1, name:"Plain Gel", price:300, cat:"Manicure", img:"https://images.unsplash.com/photo-1595461505976-7f65d0c7b44b?auto=format&fit=crop&w=1200&q=80"},
  {id:2, name:"Tips + Gel", price:600, cat:"Manicure", img:"https://images.unsplash.com/photo-1613795033381-1b2b5b1c6c86?auto=format&fit=crop&w=1200&q=80"},
  {id:3, name:"Manicure", price:200, cat:"Manicure", img:"https://images.unsplash.com/photo-1533842952212-9f0dd430e2b7?auto=format&fit=crop&w=1200&q=80"},
  {id:4, name:"Basic Pedicure", price:400, cat:"Pedicure", img:"https://images.unsplash.com/photo-1620774314981-f6e24358af08?auto=format&fit=crop&w=1200&q=80"},
  {id:5, name:"Gel Pedicure", price:700, cat:"Pedicure", img:"https://images.unsplash.com/photo-1585238342029-6dbc7d6b7b53?auto=format&fit=crop&w=1200&q=80"},
  {id:6, name:"Full Hand Design", price:800, cat:"Nail Art", img:"https://images.unsplash.com/photo-1607102736841-4d5d50b2d6f3?auto=format&fit=crop&w=1200&q=80"},
  {id:7, name:"Marble Effect", price:100, cat:"Nail Art", img:"https://images.unsplash.com/photo-1518894124859-9c4f9d7fd3d1?auto=format&fit=crop&w=1200&q=80"},
  {id:8, name:"Glitter Finish", price:100, cat:"Nail Art", img:"https://images.unsplash.com/photo-1503602642458-232111445657?auto=format&fit=crop&w=1200&q=80"}
];
const defaultHands = [
  {id:1, title:"Elegant Hand Art", img:"https://images.unsplash.com/photo-1601213100381-2bdcc45f0c36?auto=format&fit=crop&w=1200&q=80", price:1200},
  {id:2, title:"Rose Gold Hands", img:"https://images.unsplash.com/photo-1613795033381-1b2b5b1c6c86?auto=format&fit=crop&w=1200&q=80", price:1500}
];
const defaultLegs = [
  {id:1, title:"Pedicure Perfection", img:"https://images.unsplash.com/photo-1585238342029-6dbc7d6b7b53?auto=format&fit=crop&w=1200&q=80", price:1800},
  {id:2, title:"Summer Toes", img:"https://images.unsplash.com/photo-1526045612212-70caf35c14df?auto=format&fit=crop&w=1200&q=80", price:1000}
];

/* initialize storage if empty */
if(!load(STORAGE_KEYS.SERVICES)) save(STORAGE_KEYS.SERVICES, defaultServices);
if(!load(STORAGE_KEYS.HANDS)) save(STORAGE_KEYS.HANDS, defaultHands);
if(!load(STORAGE_KEYS.LEGS)) save(STORAGE_KEYS.LEGS, defaultLegs);
if(!load(STORAGE_KEYS.REQUESTS)) save(STORAGE_KEYS.REQUESTS, []);
if(!load(STORAGE_KEYS.REVIEWS)) save(STORAGE_KEYS.REVIEWS, []);
if(!load(STORAGE_KEYS.BG)) save(STORAGE_KEYS.BG, 'https://images.unsplash.com/photo-1595461505976-7f65d0c7b44b?auto=format&fit=crop&w=1600&q=80');
if(!load(STORAGE_KEYS.OWNER_NUMBER)) save(STORAGE_KEYS.OWNER_NUMBER, '0714854394');

/* -------------- Helper UI functions -------------- */
function setHeroBackground(url){
  document.getElementById('hero').style.backgroundImage = `url('${url}')`;
  save(STORAGE_KEYS.BG, url);
}

/* render services area */
function renderServices(){
  const services = load(STORAGE_KEYS.SERVICES, []);
  const grid = document.getElementById('servicesGrid');
  grid.innerHTML = '';
  const sel = document.getElementById('serviceSelect');
  sel.innerHTML = '<option value="">Select a service</option>';
  services.forEach(s=>{
    const card = document.createElement('div');
    card.className = 'service-card bg-white rounded-lg overflow-hidden shadow';
    card.innerHTML = `
      <img src="${s.img}" alt="${s.name}" loading="lazy" />
      <div class="p-4">
        <h4 class="font-semibold text-pink-600">${s.name}</h4>
        <p class="text-sm text-gray-600 mb-2">${s.cat}</p>
        <p class="text-lg font-bold">KSh ${s.price}</p>
      </div>
    `;
    grid.appendChild(card);

    // add to select
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.textContent = `${s.name} — KSh ${s.price}`;
    sel.appendChild(opt);
  });
}

/* render gallery cards */
function renderGallery(){
  const hands = load(STORAGE_KEYS.HANDS, []);
  const legs = load(STORAGE_KEYS.LEGS, []);
  const handsDiv = document.getElementById('handsGallery');
  const legsDiv = document.getElementById('legsGallery');
  handsDiv.innerHTML = '';
  legsDiv.innerHTML = '';

  hands.forEach((h, idx)=>{
    const d = document.createElement('div');
    d.className = 'bg-white rounded-lg overflow-hidden shadow';
    d.innerHTML = `
      <img src="${h.img}" alt="${h.title}" loading="lazy" class="w-full h-72 md:h-96 object-cover cursor-pointer" data-index="${idx}" data-type="hands">
      <div class="p-3">
        <h4 class="font-semibold text-pink-600">${h.title}</h4>
        <p class="text-sm text-gray-600">KSh ${h.price}</p>
      </div>
    `;
    handsDiv.appendChild(d);
  });

  legs.forEach((h, idx)=>{
    const d = document.createElement('div');
    d.className = 'bg-white rounded-lg overflow-hidden shadow';
    d.innerHTML = `
      <img src="${h.img}" alt="${h.title}" loading="lazy" class="w-full h-72 md:h-96 object-cover cursor-pointer" data-index="${idx}" data-type="legs">
      <div class="p-3">
        <h4 class="font-semibold text-pink-600">${h.title}</h4>
        <p class="text-sm text-gray-600">KSh ${h.price}</p>
      </div>
    `;
    legsDiv.appendChild(d);
  });

  // attach click handlers for fullscreen
  document.querySelectorAll('#handsGallery img, #legsGallery img').forEach(img=>{
    img.addEventListener('click', (e)=>{
      const src = e.currentTarget.src;
      const type = e.currentTarget.dataset.type;
      const idx = parseInt(e.currentTarget.dataset.index,10);
      openFS(type, idx);
    });
  });
}

/* fullscreen handling with next/prev */
let fsList = []; // array of {type, index}
let fsCurrent = 0;
function buildFsList(){
  fsList = [];
  const hands = load(STORAGE_KEYS.HANDS, []);
  hands.forEach((h,i)=> fsList.push({type:'hands', index:i}));
  const legs = load(STORAGE_KEYS.LEGS, []);
  legs.forEach((l,i)=> fsList.push({type:'legs', index:i}));
}
function openFS(type, idx){
  buildFsList();
  // find position in fsList
  const pos = fsList.findIndex(it=> it.type===type && it.index===idx);
  if(pos<0) return;
  fsCurrent = pos;
  showFS();
}
function showFS(){
  const info = fsList[fsCurrent];
  const arr = (info.type==='hands') ? load(STORAGE_KEYS.HANDS,[]) : load(STORAGE_KEYS.LEGS,[]);
  const item = arr[info.index];
  const img = document.getElementById('fsImg');
  img.src = item.img;
  document.getElementById('fsCaption').innerText = `${item.title} — KSh ${item.price}`;
  document.getElementById('fsImg').classList.remove('zoomed');
  document.getElementById('fsModal').style.display = 'flex';
}
document.getElementById('fsClose').addEventListener('click',()=>{ document.getElementById('fsModal').style.display='none'; });
document.getElementById('fsNext').addEventListener('click', ()=>{
  fsCurrent = (fsCurrent + 1) % fsList.length;
  showFS();
});
document.getElementById('fsPrev').addEventListener('click', ()=>{
  fsCurrent = (fsCurrent - 1 + fsList.length) % fsList.length;
  showFS();
});
document.getElementById('fsImg').addEventListener('click', function(){ this.classList.toggle('zoomed'); });

/* keyboard support */
document.addEventListener('keydown', (e)=>{
  if(document.getElementById('fsModal').style.display==='flex'){
    if(e.key==='ArrowRight') { document.getElementById('fsNext').click(); }
    if(e.key==='ArrowLeft') { document.getElementById('fsPrev').click(); }
    if(e.key==='Escape') { document.getElementById('fsClose').click(); }
  }
});

/* touch swipe support for fsModal */
let touchStartX = 0;
document.getElementById('fsImg').addEventListener('touchstart', e=> touchStartX = e.changedTouches[0].clientX);
document.getElementById('fsImg').addEventListener('touchend', e=>{
  const diff = e.changedTouches[0].clientX - touchStartX;
  if(diff>50) document.getElementById('fsPrev').click();
  else if(diff<-50) document.getElementById('fsNext').click();
});

/* booking / requests */
function sendRequest(){
  if (load(STORAGE_KEYS.REQUESTS, null) === null) save(STORAGE_KEYS.REQUESTS, []);
  const name = document.getElementById('clientName').value.trim();
  const phone = document.getElementById('clientPhone').value.trim();
  const serviceId = document.getElementById('serviceSelect').value;
  const datetime = document.getElementById('serviceDatetime').value;
  if(!name || !phone || !serviceId || !datetime){ alert('Please complete all fields'); return; }
  const services = load(STORAGE_KEYS.SERVICES, []);
  const svc = services.find(s=> String(s.id) === String(serviceId));
  const reqs = load(STORAGE_KEYS.REQUESTS, []);
  const newReq = { id: Date.now(), name, phone, serviceId: svc.id, serviceName: svc.name, datetime, status:'Pending' };
  reqs.unshift(newReq);
  save(STORAGE_KEYS.REQUESTS, reqs);
  document.getElementById('requestMsg').classList.remove('hidden');
  setTimeout(()=> document.getElementById('requestMsg').classList.add('hidden'),3000);
  // add simple client update for now
  const upd = document.getElementById('clientUpdates');
  const li = document.createElement('li');
  li.textContent = `Request sent: ${svc.name} on ${new Date(datetime).toLocaleString()}`;
  upd.prepend(li);
  renderOwnerRequests();
  notifyBrowser('Request Sent', `Your request for ${svc.name} has been sent.`);
  // clear inputs
  document.getElementById('clientName').value=''; document.getElementById('clientPhone').value=''; document.getElementById('serviceDatetime').value='';
}

/* render owner requests list in owner panel */
function renderOwnerRequests(){
  const requests = load(STORAGE_KEYS.REQUESTS, []);
  const container = document.getElementById('ownerRequests');
  if(!container) return;
  container.innerHTML = '';
  requests.forEach(req=>{
    const div = document.createElement('div');
    div.className = 'p-3 bg-white rounded shadow flex items-center justify-between';
    div.innerHTML = `<div>
      <div class="font-semibold">${req.name} — ${req.serviceName}</div>
      <div class="text-sm text-gray-600">${new Date(req.datetime).toLocaleString()}</div>
      <div class="text-sm text-gray-500">Status: <span id="status-${req.id}">${req.status}</span></div>
    </div>`;
    const actions = document.createElement('div');
    const accept = document.createElement('button');
    accept.textContent = 'Accept'; accept.className='bg-green-600 text-white px-3 py-1 rounded mr-2';
    accept.onclick = ()=> ownerHandleRequest(req.id, true);
    const cancel = document.createElement('button');
    cancel.textContent = 'Cancel'; cancel.className='bg-red-500 text-white px-3 py-1 rounded';
    cancel.onclick = ()=> ownerHandleRequest(req.id, false);
    actions.appendChild(accept); actions.appendChild(cancel);
    div.appendChild(actions);
    container.appendChild(div);
  });
}

/* owner accept/cancel handler */
function ownerHandleRequest(id, accepted){
  const requests = load(STORAGE_KEYS.REQUESTS, []);
  const idx = requests.findIndex(r=> r.id===id);
  if(idx<0) return;
  if(!accepted){
    if(!confirm('Are you sure you want to cancel this request?')) return;
    requests[idx].status='Cancelled';
    notifyBrowser('Request Cancelled', `${requests[idx].name}, your request for ${requests[idx].serviceName} was cancelled.`);
  } else {
    requests[idx].status='Accepted';
    notifyBrowser('Request Accepted', `${requests[idx].name}, your request for ${requests[idx].serviceName} was accepted!`);
  }
  save(STORAGE_KEYS.REQUESTS, requests);
  renderOwnerRequests();
  // also update client updates (simple UI)
  const upd = document.getElementById('clientUpdates');
  const li = document.createElement('li');
  li.textContent = `Request ${accepted? 'accepted': 'cancelled'}: ${requests[idx].serviceName} — ${new Date().toLocaleString()}`;
  upd.prepend(li);
}

/* Reviews */
function initStars(){
  const wrap = document.getElementById('starWrap');
  wrap.innerHTML = '';
  for(let i=1;i<=5;i++){
    const s = document.createElement('button');
    s.innerHTML='★'; s.className='text-xl text-gray-400';
    s.dataset.val=i;
    s.addEventListener('click', ()=> {
      setRating(i);
    });
    wrap.appendChild(s);
  }
}
function setRating(n){
  document.querySelectorAll('#starWrap button').forEach((b,idx)=> {
    b.style.color = (idx < n) ? 'gold' : '#9ca3af';
  });
  document.getElementById('starWrap').dataset.rating = n;
}
document.getElementById('sendReviewBtn').addEventListener('click', ()=>{
  const rating = parseInt(document.getElementById('starWrap').dataset.rating || 0,10);
  const text = document.getElementById('reviewText').value.trim();
  if(!rating) return alert('Please choose a rating');
  const reviews = load(STORAGE_KEYS.REVIEWS, []);
  reviews.unshift({id:Date.now(), rating, text, date: new Date().toISOString()});
  save(STORAGE_KEYS.REVIEWS, reviews);
  document.getElementById('reviewText').value='';
  renderReviews();
  notifyBrowser('New Review', 'A client has submitted a new review.');
});

/* render reviews */
function renderReviews(){
  const reviews = load(STORAGE_KEYS.REVIEWS, []);
  const list = document.getElementById('reviewsList');
  list.innerHTML = '';
  reviews.forEach(r=>{
    const d = document.createElement('div');
    d.className = 'p-2 bg-white rounded shadow';
    d.innerHTML = `<div class="flex items-center gap-2"><strong>${'★'.repeat(r.rating)}</strong><span class="text-sm text-gray-500">${new Date(r.date).toLocaleDateString()}</span></div>
                   <p class="text-sm text-gray-700 mt-1">${r.text}</p>`;
    list.appendChild(d);
  });
}

/* notifications (browser) */
async function notifyBrowser(title, body){
  if (!('Notification' in window)) return;
  if (Notification.permission === 'granted') {
    new Notification(title, { body, icon: '' });
  } else if (Notification.permission !== 'denied') {
    const perm = await Notification.requestPermission();
    if (perm === 'granted') new Notification(title, { body, icon: '' });
  }
}

/* -------------- Admin functions: owner/developer ---------------- */
function showOwner(){ document.getElementById('ownerSection').style.display='block'; document.getElementById('devSection').style.display='none'; document.body.scrollTop=0; window.location.hash='owner'; }
function showDev(){ document.getElementById('devSection').style.display='block'; document.getElementById('ownerSection').style.display='none'; document.body.scrollTop=0; window.location.hash='developer'; }
function goHome(){ document.getElementById('ownerSection').style.display='none'; document.getElementById('devSection').style.display='none'; window.location.hash=''; location.hash=''; window.scrollTo(0,0); }

/* Owner login / set password */
document.getElementById('ownerLoginBtn').addEventListener('click', ()=>{
  const input = document.getElementById('ownerPass').value;
  if(!input) return alert('Enter a password');
  const saved = load(STORAGE_KEYS.OWNER_PASS, null);
  if(!saved){ save(STORAGE_KEYS.OWNER_PASS, input); alert('Owner password set. Keep it safe.'); }
  if(saved && saved !== input) return alert('Wrong owner password');
  // show admin controls area already visible by visiting #owner — we set password earlier
  alert('Owner authenticated');
  // fill owner number
  document.getElementById('ownerNumber').value = load(STORAGE_KEYS.OWNER_NUMBER,'0714854394');
  renderOwnerRequests();
});

/* save owner contact number */
document.getElementById('saveOwnerNum').addEventListener('click', ()=>{
  const num = document.getElementById('ownerNumber').value.trim();
  if(!num) return alert('Enter number');
  save(STORAGE_KEYS.OWNER_NUMBER, num);
  document.getElementById('ownerCall').href = `tel:${num}`;
  document.getElementById('ownerCall').innerText = num;
  document.getElementById('ownerWhatsApp').href = `https://wa.me/254${num.slice(1)}`;
  alert('Owner number saved');
});

/* bg upload owner */
document.getElementById('saveBg').addEventListener('click', ()=>{
  const file = document.getElementById('bgUpload').files[0];
  if(!file) return alert('Choose an image');
  const reader = new FileReader();
  reader.onload = (e)=> {
    setHeroBackground(e.target.result);
    alert('Background updated (stored locally)');
  };
  reader.readAsDataURL(file);
});

/* add service owner */
document.getElementById('addServiceBtn').addEventListener('click', ()=>{
  const name = document.getElementById('svcName').value.trim();
  const price = document.getElementById('svcPrice').value.trim();
  const cat = document.getElementById('svcCat').value.trim() || 'Manicure';
  const file = document.getElementById('svcImage').files[0];

  if(!name || !price || !file) return alert('Provide name, price and image');
  const reader = new FileReader();
  reader.onload = (e)=>{
    const services = load(STORAGE_KEYS.SERVICES, []);
    const newSvc = { id: Date.now(), name, price: Number(price), cat, img: e.target.result };
    services.unshift(newSvc);
    save(STORAGE_KEYS.SERVICES, services);
    renderServices();
    alert('Service added (locally).');
    // clear fields
    document.getElementById('svcName').value=''; document.getElementById('svcPrice').value=''; document.getElementById('svcCat').value=''; document.getElementById('svcImage').value='';
  };
  reader.readAsDataURL(file);
});

/* clear local services (owner) - use with care */
document.getElementById('clearServicesBtn').addEventListener('click', ()=>{
  if(!confirm('Clear *local* services and reset defaults?')) return;
  save(STORAGE_KEYS.SERVICES, defaultServices);
  renderServices();
  alert('Services reset.');
});

/* add hand / leg images (owner) */
document.getElementById('addHandBtn').addEventListener('click', ()=>{
  const f = document.getElementById('uploadHand').files[0];
  if(!f) return alert('Choose a hand image to upload');
  const reader = new FileReader();
  reader.onload = e=>{
    const hands = load(STORAGE_KEYS.HANDS, []);
    hands.unshift({id:Date.now(), title:'Custom Hand Photo', img:e.target.result, price: '—'});
    save(STORAGE_KEYS.HANDS, hands);
    renderGallery();
    alert('Hand image added.');
  };
  reader.readAsDataURL(f);
});
document.getElementById('addLegBtn').addEventListener('click', ()=>{
  const f = document.getElementById('uploadLeg').files[0];
  if(!f) return alert('Choose a leg image to upload');
  const reader = new FileReader();
  reader.onload = e=>{
    const legs = load(STORAGE_KEYS.LEGS, []);
    legs.unshift({id:Date.now(), title:'Custom Leg Photo', img:e.target.result, price:'—'});
    save(STORAGE_KEYS.LEGS, legs);
    renderGallery();
    alert('Leg image added.');
  };
  reader.readAsDataURL(f);
});

/* Developer functions */
document.getElementById('devLoginBtn').addEventListener('click', ()=>{
  const pass = document.getElementById('devPass').value;
  if(!pass) return alert('Enter a password to set or log in');
  const saved = load(STORAGE_KEYS.DEV_PASS, null);
  if(!saved) { save(STORAGE_KEYS.DEV_PASS, pass); alert('Developer password set.'); }
  if(saved && saved !== pass) return alert('Wrong developer password');
  alert('Developer authenticated');
});

document.getElementById('enableMaint').addEventListener('click', ()=>{
  save('salon_maintenance', true);
  document.getElementById('maintStatus').innerText = 'Status: ON';
  alert('Maintenance ON — site functions are disabled for users and owner until disabled.');
});
document.getElementById('disableMaint').addEventListener('click', ()=>{
  save('salon_maintenance', false);
  document.getElementById('maintStatus').innerText = 'Status: OFF';
  alert('Maintenance OFF');
});

/* Developer BG upload */
document.getElementById('devSaveBg').addEventListener('click', ()=>{
  const f = document.getElementById('devBgUpload').files[0];
  if(!f) return alert('Pick an image file first');
  const r = new FileReader();
  r.onload = e=> { setHeroBackground(e.target.result); alert('Background changed by developer'); };
  r.readAsDataURL(f);
});

/* developer add hand/leg */
document.getElementById('devAddHand').addEventListener('click', ()=>{
  const f = document.getElementById('devHandFile').files[0];
  if(!f) return alert('Choose a file');
  const r = new FileReader();
  r.onload = e=>{
    const hands = load(STORAGE_KEYS.HANDS, []);
    hands.unshift({id:Date.now(), title:'Dev Hand Photo', img:e.target.result, price:'—'});
    save(STORAGE_KEYS.HANDS, hands);
    renderGallery(); alert('Developer added hand photo');
  };
  r.readAsDataURL(f);
});
document.getElementById('devAddLeg').addEventListener('click', ()=>{
  const f = document.getElementById('devLegFile').files[0];
  if(!f) return alert('Choose a file');
  const r = new FileReader();
  r.onload = e=>{
    const legs = load(STORAGE_KEYS.LEGS, []);
    legs.unshift({id:Date.now(), title:'Dev Leg Photo', img:e.target.result, price:'—'});
    save(STORAGE_KEYS.LEGS, legs);
    renderGallery(); alert('Developer added leg photo');
  };
  r.readAsDataURL(f);
});

/* owner link click opens owner panel (hash route) */
document.getElementById('ownerLink').addEventListener('click', (e)=>{ e.preventDefault(); showOwner(); });
document.getElementById('devLink').addEventListener('click', (e)=>{ e.preventDefault(); showDev(); });

/* init UI on load */
function init(){
  // hero bg
  setHeroBackground(load(STORAGE_KEYS.BG));
  // services & gallery
  renderServices();
  renderGallery();
  buildFsList();
  renderReviews();
  initStars();
  // fill service select on load
  renderServices();
  // owner number
  const num = load(STORAGE_KEYS.OWNER_NUMBER, '0714854394');
  document.getElementById('ownerCall').href = `tel:${num}`;
  document.getElementById('ownerCall').innerText = num;
  document.getElementById('ownerWhatsApp').href = `https://wa.me/254${num.slice(1)}`;
  // glide path: handle hash route
  if(location.hash === '#owner') showOwner();
  if(location.hash === '#developer') showDev();
}
init();

/* attach request button */
document.getElementById('requestBtn').addEventListener('click', sendRequest);

</script>
</body>
</html>
